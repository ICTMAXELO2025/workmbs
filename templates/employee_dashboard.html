{% extends "base.html" %}

{% block title %}Employee Dashboard - Company Management System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Employee Dashboard</h2>
            <span class="badge bg-primary">Welcome, {{ current_user.name }}</span>
        </div>
    </div>
</div>

<!-- Statistics Cards -->
<div class="row">
    <div class="col-md-3">
        <div class="stat-card text-center">
            <i class="fas fa-calendar-times fa-2x text-warning mb-2"></i>
            <h3>{{ pending_leaves }}</h3>
            <p class="text-muted">Pending Leaves</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card text-center">
            <i class="fas fa-envelope fa-2x text-info mb-2"></i>
            <h3>{{ unread_messages }}</h3>
            <p class="text-muted">Unread Messages</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card text-center">
            <i class="fas fa-tasks fa-2x text-danger mb-2"></i>
            <h3>{{ pending_todos }}</h3>
            <p class="text-muted">Pending Tasks</p>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card text-center">
            <i class="fas fa-calendar-check fa-2x text-success mb-2"></i>
            <h3>{{ approved_leaves }}</h3>
            <p class="text-muted">Approved Leaves</p>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Recent Leave Requests -->
    <div class="col-md-6">
        <div class="stat-card">
            <h4><i class="fas fa-history"></i> Recent Leave Requests</h4>
            {% if recent_leaves %}
                {% for leave in recent_leaves %}
                <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                    <div>
                        <strong>{{ leave.leave_type|title }}</strong>
                        <br>
                        <small class="text-muted">{{ leave.start_date }} to {{ leave.end_date }}</small>
                    </div>
                    <span class="badge bg-{{ 'success' if leave.status == 'approved' else 'warning' if leave.status == 'pending' else 'danger' }}">
                        {{ leave.status|title }}
                    </span>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No leave requests yet.</p>
            {% endif %}
            <div class="mt-3">
                <a href="{{ url_for('employee_leave_request') }}" class="btn btn-primary btn-sm">Request Leave</a>
                <a href="{{ url_for('employee_leave') }}" class="btn btn-outline-primary btn-sm">View All</a>
            </div>
        </div>
    </div>

    <!-- Upcoming Tasks -->
    <div class="col-md-6">
        <div class="stat-card">
            <h4><i class="fas fa-tasks"></i> Upcoming Tasks</h4>
            {% if upcoming_todos %}
                {% for todo in upcoming_todos %}
                <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                    <div>
                        <strong>{{ todo.content }}</strong>
                        {% if todo.due_date %}
                        <br>
                        <small class="text-muted">Due: {{ todo.due_date }}</small>
                        {% endif %}
                    </div>
                    <span class="badge bg-{{ 'danger' if todo.priority == 'high' else 'warning' if todo.priority == 'medium' else 'info' }}">
                        {{ todo.priority|title }}
                    </span>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No upcoming tasks.</p>
            {% endif %}
            <div class="mt-3">
                <a href="{{ url_for('employee_todos_add') }}" class="btn btn-primary btn-sm">Add Task</a>
                <a href="{{ url_for('employee_todos') }}" class="btn btn-outline-primary btn-sm">View All</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Recent Messages -->
    <div class="col-md-6">
        <div class="stat-card">
            <h4><i class="fas fa-envelope"></i> Recent Messages</h4>
            {% if recent_messages %}
                {% for message in recent_messages %}
                <div class="border-bottom py-2">
                    <strong>{{ message.subject }}</strong>
                    <p class="mb-1 text-muted small">{{ message.content[:100] }}{% if message.content|length > 100 %}...{% endif %}</p>
                    <small class="text-muted">Received: {{ message.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                    {% if not message.is_read %}
                    <span class="badge bg-danger float-end">New</span>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No messages yet.</p>
            {% endif %}
            <div class="mt-3">
                <a href="{{ url_for('employee_messages_send') }}" class="btn btn-primary btn-sm">Send Message</a>
                <a href="{{ url_for('employee_messages') }}" class="btn btn-outline-primary btn-sm">View All</a>
            </div>
        </div>
    </div>

    <!-- Announcements -->
    <div class="col-md-6">
        <div class="stat-card">
            <h4><i class="fas fa-bullhorn"></i> Announcements</h4>
            {% if announcements %}
                {% for announcement in announcements %}
                <div class="border-bottom py-2">
                    <strong>{{ announcement.title }}</strong>
                    <p class="mb-1 text-muted">{{ announcement.content[:100] }}{% if announcement.content|length > 100 %}...{% endif %}</p>
                    <small class="text-muted">Posted: {{ announcement.created_at.strftime('%Y-%m-%d') }}</small>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No announcements at this time.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}